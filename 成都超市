-- 防閒置檢測
local VirtualUser = game:GetService("VirtualUser")
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new(0,0))
end)

-- 禁用相機震動
local main = require(game:GetService("ReplicatedStorage").Util.CameraShaker.Main)
local returnnil = function() return nil end
main.StartShake = returnnil
main.ShakeOnce = returnnil
main.ShakeSustain = returnnil
main.CameraShakeInstance = returnnil
main.Shake = returnnil
main.Start = returnnil

-- UI庫（您提供的代碼）
local library = { _Tabs = {}, _Pages = {} }
local services = setmetatable({}, {__index = function(_, k) return game:GetService(k) end})
local ts, uis, players = services.TweenService, services.UserInputService, services.Players
local lp = players.LocalPlayer
local playerGui = lp:WaitForChild("PlayerGui", 15) or game:GetService("CoreGui")

-- 简化UI库，确保能正确显示
function library:AddDrag(obj)
    local dragging, dragStart, startPos
    obj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = obj.Position
        end
    end)
    uis.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    uis.InputEnded:Connect(function() dragging = false end)
end

function library.new(name)
    local sg = Instance.new("ScreenGui")
    sg.Name = "GG_Center"
    sg.ResetOnSpawn = false
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    sg.Parent = playerGui

    -- 简化加载动画
    task.wait(0.5)

    local Main = Instance.new("Frame", sg)
    Main.Size = UDim2.new(0, 450, 0, 400) -- 固定大小，不要自动调整
    Main.Position = UDim2.new(0.5, -225, 0.5, -200)
    Main.BackgroundColor3 = Color3.fromRGB(15, 17, 22)
    Main.Visible = false
    Main.ClipsDescendants = true
    Instance.new("UICorner", Main)
    library:AddDrag(Main)
    library.Main = Main

    -- 侧边切换按钮
    local ToggleBtn = Instance.new("TextButton", sg)
    ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
    ToggleBtn.Position = UDim2.new(0, 20, 0, 20)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
    ToggleBtn.Text = "GG"
    ToggleBtn.TextColor3 = Color3.fromRGB(0, 255, 255)
    ToggleBtn.TextSize = 20
    ToggleBtn.ZIndex = 10
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    Instance.new("UIStroke", ToggleBtn).Color = Color3.fromRGB(0, 255, 255)
    library:AddDrag(ToggleBtn)

    -- 点击打开/关闭UI
    ToggleBtn.MouseButton1Click:Connect(function()
        if not Main.Visible then
            Main.Size = UDim2.new(0, 450, 0, 0)
            Main.Visible = true
            ts:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 450, 0, 400)}):Play()
        else
            ts:Create(Main, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {Size = UDim2.new(0, 450, 0, 0)}):Play()
            task.wait(0.3)
            Main.Visible = false
        end
    end)

    return library
end

function library:CreateTab(name)
    local SideBar = self.Main:FindFirstChild("SideBar") or Instance.new("Frame", self.Main)
    
    if SideBar.Name ~= "SideBar" then
        SideBar.Name = "SideBar"
        SideBar.Size = UDim2.new(0, 110, 1, 0)
        SideBar.BackgroundColor3 = Color3.fromRGB(10, 12, 15)
        Instance.new("UICorner", SideBar)
        local layout = Instance.new("UIListLayout", SideBar)
        layout.Padding = UDim.new(0, 5)
        layout.HorizontalAlignment = "Center"
    end

    local ContentPage = Instance.new("Frame", self.Main) -- 使用Frame而不是ScrollingFrame
    ContentPage.Name = name .. "_Page"
    ContentPage.Size = UDim2.new(1, -125, 1, -20)
    ContentPage.Position = UDim2.new(0, 120, 0, 10)
    ContentPage.BackgroundTransparency = 1
    ContentPage.Visible = false
    ContentPage.ClipsDescendants = true -- 防止内容溢出
    
    -- 使用CanvasGroup来确保内容正确显示
    local canvasGroup = Instance.new("CanvasGroup", ContentPage)
    canvasGroup.Size = UDim2.new(1, 0, 1, 0)
    
    -- 使用ScrollFrame包装内容
    local scrollFrame = Instance.new("ScrollingFrame", canvasGroup)
    scrollFrame.Size = UDim2.new(1, 0, 1, 0)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.ScrollBarThickness = 3
    scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 255, 200)
    scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    
    local pageLayout = Instance.new("UIListLayout", scrollFrame)
    pageLayout.Padding = UDim.new(0, 8)
    pageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    local TabBtn = Instance.new("TextButton", SideBar)
    TabBtn.Size = UDim2.new(0.9, 0, 0, 35)
    TabBtn.Text = name
    TabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    TabBtn.BackgroundTransparency = 1
    TabBtn.Font = Enum.Font.Code

    TabBtn.MouseButton1Click:Connect(function()
        for _, p in pairs(self._Pages) do 
            p.Visible = false 
        end
        ContentPage.Visible = true
    end)

    table.insert(self._Pages, ContentPage)
    
    if #self._Pages == 1 then 
        ContentPage.Visible = true 
    end
    
    return scrollFrame -- 返回滚动框架，这样可以直接添加元素
end

-- 创建UI元素的辅助函数
function CreateButton(parent, text, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0.9, 0, 0, 35)
    btn.Position = UDim2.new(0.05, 0, 0, 0) -- 居中显示
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(30, 35, 45)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamSemibold
    Instance.new("UICorner", btn)
    
    -- 悬停效果
    btn.MouseEnter:Connect(function()
        ts:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 45, 55)}):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        ts:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(30, 35, 45)}):Play()
    end)
    
    -- 点击效果
    btn.MouseButton1Click:Connect(function()
        ts:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(50, 55, 65)}):Play()
        task.wait(0.1)
        ts:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(40, 45, 55)}):Play()
        
        if callback then
            callback()
        end
    end)
    
    return btn
end

function CreateToggle(parent, text, default, callback)
    local container = Instance.new("Frame", parent)
    container.Size = UDim2.new(0.9, 0, 0, 35)
    container.Position = UDim2.new(0.05, 0, 0, 0)
    container.BackgroundTransparency = 1
    
    local label = Instance.new("TextLabel", container)
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local toggleFrame = Instance.new("TextButton", container)
    toggleFrame.Size = UDim2.new(0, 50, 0, 25)
    toggleFrame.Position = UDim2.new(1, -50, 0.5, -12.5)
    toggleFrame.Text = ""
    toggleFrame.BackgroundColor3 = default and Color3.fromRGB(0, 100, 80) or Color3.fromRGB(50, 50, 50)
    Instance.new("UICorner", toggleFrame).CornerRadius = UDim.new(1, 0)
    
    local toggleCircle = Instance.new("Frame", toggleFrame)
    toggleCircle.Size = UDim2.new(0, 20, 0, 20)
    toggleCircle.Position = default and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
    toggleCircle.BackgroundColor3 = default and Color3.fromRGB(0, 255, 200) or Color3.fromRGB(255, 255, 255)
    Instance.new("UICorner", toggleCircle).CornerRadius = UDim.new(1, 0)
    
    local toggled = default or false
    
    local function updateToggle()
        if toggled then
            ts:Create(toggleCircle, TweenInfo.new(0.2), {
                Position = UDim2.new(1, -22, 0.5, -10),
                BackgroundColor3 = Color3.fromRGB(0, 255, 200)
            }):Play()
            ts:Create(toggleFrame, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(0, 100, 80)
            }):Play()
        else
            ts:Create(toggleCircle, TweenInfo.new(0.2), {
                Position = UDim2.new(0, 2, 0.5, -10),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
            ts:Create(toggleFrame, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            }):Play()
        end
        if callback then callback(toggled) end
    end
    
    toggleFrame.MouseButton1Click:Connect(function()
        toggled = not toggled
        updateToggle()
    end)
    
    return {Container = container, Value = function() return toggled end}
end

function CreateLabel(parent, text)
    local label = Instance.new("TextLabel", parent)
    label.Size = UDim2.new(0.9, 0, 0, 30)
    label.Position = UDim2.new(0.05, 0, 0, 0)
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Center
    return label
end

-- 创建主窗口
local window = library.new("GG中心")

-- 创建选项卡
local tab1 = window:CreateTab("公告")
local tab2 = window:CreateTab("脚本")
local tab3 = window:CreateTab("秒杀")
local tab4 = window:CreateTab("透视")
local tab5 = window:CreateTab("传送")

-- 1. 公告页面 - 添加实际元素
CreateLabel(tab1, "GG脚本中心")
CreateLabel(tab1, "Version 1.0")
CreateLabel(tab1, "秦始皇制作")
CreateButton(tab1, "测试按钮", function()
    print("公告页面按钮被点击！")
end)

-- 2. 脚本页面
CreateLabel(tab2, "脚本功能设置")

-- 视角缩放
CreateButton(tab2, "设置视角缩放: 500", function()
    game:GetService("Players").LocalPlayer.CameraMaxZoomDistance = 500
    print("视角缩放已设置为500")
end)

CreateButton(tab2, "设置视角缩放: 1000", function()
    game:GetService("Players").LocalPlayer.CameraMaxZoomDistance = 1000
    print("视角缩放已设置为1000")
end)

-- 自动V4
local autoV4Toggle = CreateToggle(tab2, "自动V4", false, function(state)
    print("自动V4: " .. tostring(state))
end)

-- 飞行脚本
CreateButton(tab2, "飞行脚本", function()
    print("飞行脚本已激活")
    -- 简单的飞行功能
    local player = game.Players.LocalPlayer
    local flying = false
    
    if not player.Character then return end
    
    if not flying then
        flying = true
        local bodyVelocity = Instance.new("BodyVelocity", player.Character.HumanoidRootPart)
        bodyVelocity.MaxForce = Vector3.new(40000, 40000, 40000)
        
        spawn(function()
            while flying do
                wait()
                local direction = Vector3.new(0, 0, 0)
                
                if uis:IsKeyDown(Enum.KeyCode.W) then
                    direction = direction + Vector3.new(0, 0, -1)
                end
                if uis:IsKeyDown(Enum.KeyCode.S) then
                    direction = direction + Vector3.new(0, 0, 1)
                end
                if uis:IsKeyDown(Enum.KeyCode.A) then
                    direction = direction + Vector3.new(-1, 0, 0)
                end
                if uis:IsKeyDown(Enum.KeyCode.D) then
                    direction = direction + Vector3.new(1, 0, 0)
                end
                if uis:IsKeyDown(Enum.KeyCode.Space) then
                    direction = direction + Vector3.new(0, 1, 0)
                end
                if uis:IsKeyDown(Enum.KeyCode.LeftShift) then
                    direction = direction + Vector3.new(0, -1, 0)
                end
                
                bodyVelocity.Velocity = direction * 50
            end
            bodyVelocity:Destroy()
        end)
    else
        flying = false
    end
end)

CreateButton(tab2, "法天象地", function()
    print("法天象地功能激活")
end)

CreateButton(tab2, "防挂机", function()
    print("防挂机已启用")
end)

-- 3. 秒杀页面
CreateLabel(tab3, "秒杀功能")

local killToggle = CreateToggle(tab3, "秒杀开关", false, function(state)
    print("秒杀开关: " .. tostring(state))
end)

CreateButton(tab3, "攻击范围: 近", function()
    print("攻击范围设置为: 近")
end)

CreateButton(tab3, "攻击范围: 中", function()
    print("攻击范围设置为: 中")
end)

CreateButton(tab3, "攻击范围: 远", function()
    print("攻击范围设置为: 远")
end)

local attackMobsToggle = CreateToggle(tab3, "自动打怪", true, function(state)
    print("自动打怪: " .. tostring(state))
end)

local attackPlayersToggle = CreateToggle(tab3, "攻击玩家", false, function(state)
    print("攻击玩家: " .. tostring(state))
end)

CreateButton(tab3, "移动加速", function()
    print("移动加速激活")
    local player = game.Players.LocalPlayer
    if player.Character then
        player.Character.Humanoid.WalkSpeed = 50
    end
end)

-- 4. 透视页面
CreateLabel(tab4, "透视设置")

local espMainToggle = CreateToggle(tab4, "透视总开关", false, function(state)
    print("透视总开关: " .. tostring(state))
    -- 简单透视实现
    if state then
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= game.Players.LocalPlayer and player.Character then
                local highlight = Instance.new("Highlight")
                highlight.FillColor = Color3.fromRGB(255, 0, 0)
                highlight.OutlineColor = Color3.fromRGB(255, 255, 0)
                highlight.FillTransparency = 0.5
                highlight.Parent = player.Character
            end
        end
    else
        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= game.Players.LocalPlayer and player.Character then
                for _, obj in pairs(player.Character:GetChildren()) do
                    if obj:IsA("Highlight") then
                        obj:Destroy()
                    end
                end
            end
        end
    end
end)

local espNameToggle = CreateToggle(tab4, "显示名字", false, function(state)
    print("显示名字: " .. tostring(state))
end)

local espHealthToggle = CreateToggle(tab4, "显示血量", false, function(state)
    print("显示血量: " .. tostring(state))
end)

local espTracerToggle = CreateToggle(tab4, "射线追踪", false, function(state)
    print("射线追踪: " .. tostring(state))
end)

-- 5. 传送页面
CreateLabel(tab5, "传送功能")

CreateButton(tab5, "传送至一海", function()
    print("正在传送至一海...")
    local player = game.Players.LocalPlayer
    if player.Character then
        -- 这里应该是实际的传送代码
        print("传送完成（模拟）")
    end
end)

CreateButton(tab5, "传送至二海", function()
    print("正在传送至二海...")
end)

CreateButton(tab5, "传送至三海", function()
    print("正在传送至三海...")
end)

CreateButton(tab5, "天鹅的房间", function()
    print("正在传送至天鹅的房间...")
end)

CreateButton(tab5, "豪宅", function()
    print("正在传送至豪宅...")
end)

CreateButton(tab5, "鬼船里", function()
    print("正在传送至鬼船里...")
end)

CreateButton(tab5, "海洋城堡", function()
    print("正在传送至海洋城堡...")
end)

CreateButton(tab5, "九头蛇", function()
    print("正在传送至九头蛇...")
end)

-- 添加一个简单的状态显示
CreateLabel(tab1, "状态: 脚本运行正常")
CreateLabel(tab1, "点击左上角GG按钮开关UI")

-- 确保UI正确显示
task.wait(0.5)
print("GG脚本已加载完成！")
print("点击屏幕左上角的圆形GG按钮打开菜单")
